@extends('layouts.master')

@section('title', '従業員アンケート')

@section('body')
    <div class="flex items-center justify-center min-h-screen bg-[#40c7bd]">
        <!-- ホーム画面 -->
        <div id="home-screen" class="bg-white rounded-3xl shadow-lg max-w-5xl w-full p-8 mx-auto border-8 border-[#7ADCD5]">
            <div class="text-center my-8 p-8 items-center justify-center">
                <div class="flex items-center justify-center">
                    <svg class="items-center justify-center" width="235" height="80" viewBox="0 0 235 80" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M111.836 23.352C109.24 23.352 106.9 23.8043 104.815 24.709C102.77 25.5743 101.039 26.833 99.623 28.485C98.207 30.0977 97.1253 32.0447 96.378 34.326C95.6307 36.568 95.257 39.0657 95.257 41.819C95.257 45.595 95.847 48.899 97.027 51.731C98.207 54.5237 99.977 56.687 102.337 58.221C104.736 59.755 107.706 60.522 111.246 60.522C113.291 60.522 115.179 60.3647 116.91 60.05C118.641 59.7353 120.234 59.342 121.689 58.87V61.82C120.273 62.3707 118.68 62.8033 116.91 63.118C115.179 63.4327 113.154 63.59 110.833 63.59C106.624 63.59 103.084 62.6853 100.213 60.876C97.381 59.0667 95.2373 56.5297 93.782 53.265C92.366 50.0003 91.658 46.185 91.658 41.819C91.658 38.7117 92.1103 35.8403 93.015 33.205C93.9197 30.5697 95.2373 28.2883 96.968 26.361C98.6987 24.4337 100.803 22.939 103.281 21.877C105.798 20.815 108.67 20.284 111.895 20.284C113.901 20.284 115.828 20.4807 117.677 20.874C119.565 21.2673 121.315 21.8377 122.928 22.585L121.571 25.594C120.076 24.8467 118.503 24.296 116.851 23.942C115.238 23.5487 113.567 23.352 111.836 23.352ZM156.207 47.306C156.207 49.7447 155.892 51.967 155.263 53.973C154.673 55.9397 153.768 57.6507 152.549 59.106C151.369 60.522 149.894 61.6233 148.124 62.41C146.354 63.1967 144.328 63.59 142.047 63.59C139.883 63.59 137.936 63.2163 136.206 62.469C134.514 61.6823 133.059 60.581 131.84 59.165C130.62 57.7097 129.696 55.979 129.067 53.973C128.437 51.967 128.123 49.7447 128.123 47.306C128.123 43.884 128.673 40.9733 129.775 38.574C130.915 36.1353 132.548 34.267 134.672 32.969C136.835 31.671 139.392 31.022 142.342 31.022C145.331 31.022 147.848 31.7103 149.894 33.087C151.978 34.4243 153.552 36.3123 154.614 38.751C155.676 41.1897 156.207 44.0413 156.207 47.306ZM131.604 47.306C131.604 49.9807 131.977 52.3407 132.725 54.386C133.472 56.392 134.632 57.9457 136.206 59.047C137.779 60.1483 139.746 60.699 142.106 60.699C144.544 60.699 146.55 60.1483 148.124 59.047C149.697 57.9063 150.857 56.333 151.605 54.327C152.352 52.2817 152.726 49.9413 152.726 47.306C152.726 44.6707 152.372 42.35 151.664 40.344C150.956 38.338 149.835 36.7647 148.301 35.624C146.767 34.4833 144.761 33.913 142.283 33.913C138.703 33.913 136.029 35.093 134.259 37.453C132.489 39.813 131.604 43.0973 131.604 47.306ZM177.615 31.081C178.401 31.081 179.149 31.14 179.857 31.258C180.604 31.3367 181.273 31.4547 181.863 31.612L181.391 34.68C180.761 34.5227 180.132 34.4047 179.503 34.326C178.873 34.208 178.185 34.149 177.438 34.149C176.022 34.149 174.743 34.4243 173.603 34.975C172.462 35.5257 171.479 36.3123 170.653 37.335C169.827 38.3577 169.197 39.577 168.765 40.993C168.332 42.409 168.116 44.002 168.116 45.772V63H164.753V31.612H167.585L167.939 37.512H168.116C168.627 36.2927 169.315 35.211 170.181 34.267C171.085 33.2837 172.167 32.5167 173.426 31.966C174.684 31.376 176.081 31.081 177.615 31.081ZM198.679 31.022C201.393 31.022 203.635 31.6513 205.405 32.91C207.214 34.1293 208.571 35.8207 209.476 37.984C210.42 40.1473 210.892 42.645 210.892 45.477V47.719H188.472C188.472 51.9277 189.436 55.1333 191.363 57.336C193.33 59.5387 196.103 60.64 199.682 60.64C201.649 60.64 203.36 60.4827 204.815 60.168C206.27 59.8533 207.863 59.3027 209.594 58.516V61.584C208.021 62.292 206.467 62.8033 204.933 63.118C203.399 63.4327 201.609 63.59 199.564 63.59C196.457 63.59 193.802 62.941 191.599 61.643C189.436 60.345 187.784 58.4963 186.643 56.097C185.542 53.6583 184.991 50.8263 184.991 47.601C184.991 44.3757 185.522 41.524 186.584 39.046C187.646 36.568 189.2 34.621 191.245 33.205C193.29 31.7497 195.768 31.022 198.679 31.022ZM198.679 33.854C195.768 33.854 193.428 34.8177 191.658 36.745C189.888 38.633 188.846 41.3667 188.531 44.946H207.411C207.411 42.7433 207.096 40.816 206.467 39.164C205.838 37.512 204.874 36.214 203.576 35.27C202.317 34.326 200.685 33.854 198.679 33.854ZM228.224 60.758C229.089 60.758 229.915 60.699 230.702 60.581C231.488 60.4237 232.177 60.2467 232.767 60.05V62.764C232.177 63 231.429 63.1967 230.525 63.354C229.659 63.5113 228.735 63.59 227.752 63.59C226.021 63.59 224.546 63.2753 223.327 62.646C222.107 61.9773 221.163 60.9547 220.495 59.578C219.865 58.2013 219.551 56.4313 219.551 54.268V34.326H214.949V32.438L219.551 31.376L220.79 24.119H222.914V31.612H232.59V34.326H222.914V54.15C222.914 56.3133 223.346 57.9653 224.212 59.106C225.077 60.2073 226.414 60.758 228.224 60.758Z"
                            fill="#2BC7BC" />
                        <path
                            d="M50.065 43C50.065 51.7438 48.6716 59.6142 46.4541 65.2619C45.3441 68.0888 44.0472 70.3087 42.6582 71.8049C41.2704 73.2999 39.8645 74 38.5003 74C37.1361 74 35.7302 73.2999 34.3424 71.8049C32.9534 70.3087 31.6565 68.0888 30.5465 65.2619C28.3289 59.6142 26.9355 51.7438 26.9355 43C26.9355 34.2562 28.3289 26.3858 30.5465 20.7381C31.6565 17.9112 32.9534 15.6913 34.3424 14.1951C35.7302 12.7001 37.1361 12 38.5003 12C39.8645 12 41.2704 12.7001 42.6582 14.1951C44.0472 15.6913 45.3441 17.9112 46.4541 20.7381C48.6716 26.3858 50.065 34.2562 50.065 43Z"
                            stroke="#2BC7BC" stroke-width="2" />
                        <path
                            d="M46.59 36.8192C54.713 43.0255 61.0476 49.3763 64.7342 54.6073C66.581 57.2279 67.7315 59.523 68.1385 61.3512C68.5515 63.2063 68.1623 64.3776 67.3208 65.0206C66.4793 65.6635 64.9463 65.9609 62.5182 65.6454C60.1254 65.3344 57.1215 64.4554 53.6916 63.0443C46.8451 60.2276 38.533 55.3877 30.41 49.1814C22.287 42.975 15.9524 36.6243 12.2658 31.3932C10.419 28.7727 9.26846 26.4775 8.86149 24.6493C8.44851 22.7942 8.83776 21.6229 9.67923 20.98C10.5207 20.337 12.0537 20.0396 14.4818 20.3552C16.8746 20.6661 19.8785 21.5452 23.3084 22.9562C30.1549 25.773 38.467 30.6128 46.59 36.8192Z"
                            stroke="#2BC7BC" stroke-width="2" />
                        <path
                            d="M46.59 49.1808C54.713 42.9745 61.0476 36.6237 64.7342 31.3927C66.581 28.7721 67.7315 26.477 68.1385 24.6488C68.5515 22.7937 68.1623 21.6224 67.3208 20.9794C66.4793 20.3365 64.9463 20.0391 62.5182 20.3546C60.1254 20.6656 57.1215 21.5446 53.6916 22.9557C46.8451 25.7724 38.533 30.6123 30.41 36.8186C22.287 43.025 15.9524 49.3757 12.2658 54.6068C10.419 57.2273 9.26846 59.5225 8.86149 61.3507C8.44851 63.2058 8.83776 64.3771 9.67923 65.02C10.5207 65.663 12.0537 65.9604 14.4818 65.6448C16.8746 65.3339 19.8785 64.4548 23.3084 63.0438C30.1549 60.227 38.467 55.3872 46.59 49.1808Z"
                            stroke="#2BC7BC" stroke-width="2" />
                        <ellipse cx="38.4999" cy="43" rx="4.27778" ry="4.17391" fill="#2BC7BC" />
                    </svg>
                </div>
                <p class="text-gray font-bold text-xl tracking-wider font-poppins pt-4">従業員アンケート</p>
            </div>

            <div class="space-y-6 mb-10 flex flex-col items-center justify-center">
                <p class="text-gray text-center leading-relaxed font-poppins text-xl tracking-wide mb-16">
                    このアンケートは、会社や組織をより良くするためのものです。<br>
                    個人の評価には<span class="border-b border-gray">一切影響しません</span>ので、ぜひ率直なご意見をお聞かせください！<br>
                    皆さんの本音の回答が、働きやすい環境づくりに役立ちます。<br>
                    所要時間は約5分です。ご協力よろしくお願いします！
                </p>
                <button id="startButton" class="bg-[#F5C242] hover:bg-[#FED670] text-white font-bold text-2xl py-[1.75rem] px-[5.5rem] tracking-wider shadow-lg rounded-xl visible">はじめる<button>
            </div>
        </div>
        <div id="department-screen" class="hidden bg-white max-w-5xl w-[80vw] rounded-3xl shadow-lg border-8 border-[#7ADCD5] overflow-auto p-8 mt-10">
            <div class="card bg-white rounded-3xl text-center flex flex-col min-h-fit">
                <div class="text-center mt-8 items-center justify-center">
                    <div class="flex items-center justify-center">
                        <svg class="items-center justify-center" width="235" height="80" viewBox="0 0 235 80"
                            fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M111.836 23.352C109.24 23.352 106.9 23.8043 104.815 24.709C102.77 25.5743 101.039 26.833 99.623 28.485C98.207 30.0977 97.1253 32.0447 96.378 34.326C95.6307 36.568 95.257 39.0657 95.257 41.819C95.257 45.595 95.847 48.899 97.027 51.731C98.207 54.5237 99.977 56.687 102.337 58.221C104.736 59.755 107.706 60.522 111.246 60.522C113.291 60.522 115.179 60.3647 116.91 60.05C118.641 59.7353 120.234 59.342 121.689 58.87V61.82C120.273 62.3707 118.68 62.8033 116.91 63.118C115.179 63.4327 113.154 63.59 110.833 63.59C106.624 63.59 103.084 62.6853 100.213 60.876C97.381 59.0667 95.2373 56.5297 93.782 53.265C92.366 50.0003 91.658 46.185 91.658 41.819C91.658 38.7117 92.1103 35.8403 93.015 33.205C93.9197 30.5697 95.2373 28.2883 96.968 26.361C98.6987 24.4337 100.803 22.939 103.281 21.877C105.798 20.815 108.67 20.284 111.895 20.284C113.901 20.284 115.828 20.4807 117.677 20.874C119.565 21.2673 121.315 21.8377 122.928 22.585L121.571 25.594C120.076 24.8467 118.503 24.296 116.851 23.942C115.238 23.5487 113.567 23.352 111.836 23.352ZM156.207 47.306C156.207 49.7447 155.892 51.967 155.263 53.973C154.673 55.9397 153.768 57.6507 152.549 59.106C151.369 60.522 149.894 61.6233 148.124 62.41C146.354 63.1967 144.328 63.59 142.047 63.59C139.883 63.59 137.936 63.2163 136.206 62.469C134.514 61.6823 133.059 60.581 131.84 59.165C130.62 57.7097 129.696 55.979 129.067 53.973C128.437 51.967 128.123 49.7447 128.123 47.306C128.123 43.884 128.673 40.9733 129.775 38.574C130.915 36.1353 132.548 34.267 134.672 32.969C136.835 31.671 139.392 31.022 142.342 31.022C145.331 31.022 147.848 31.7103 149.894 33.087C151.978 34.4243 153.552 36.3123 154.614 38.751C155.676 41.1897 156.207 44.0413 156.207 47.306ZM131.604 47.306C131.604 49.9807 131.977 52.3407 132.725 54.386C133.472 56.392 134.632 57.9457 136.206 59.047C137.779 60.1483 139.746 60.699 142.106 60.699C144.544 60.699 146.55 60.1483 148.124 59.047C149.697 57.9063 150.857 56.333 151.605 54.327C152.352 52.2817 152.726 49.9413 152.726 47.306C152.726 44.6707 152.372 42.35 151.664 40.344C150.956 38.338 149.835 36.7647 148.301 35.624C146.767 34.4833 144.761 33.913 142.283 33.913C138.703 33.913 136.029 35.093 134.259 37.453C132.489 39.813 131.604 43.0973 131.604 47.306ZM177.615 31.081C178.401 31.081 179.149 31.14 179.857 31.258C180.604 31.3367 181.273 31.4547 181.863 31.612L181.391 34.68C180.761 34.5227 180.132 34.4047 179.503 34.326C178.873 34.208 178.185 34.149 177.438 34.149C176.022 34.149 174.743 34.4243 173.603 34.975C172.462 35.5257 171.479 36.3123 170.653 37.335C169.827 38.3577 169.197 39.577 168.765 40.993C168.332 42.409 168.116 44.002 168.116 45.772V63H164.753V31.612H167.585L167.939 37.512H168.116C168.627 36.2927 169.315 35.211 170.181 34.267C171.085 33.2837 172.167 32.5167 173.426 31.966C174.684 31.376 176.081 31.081 177.615 31.081ZM198.679 31.022C201.393 31.022 203.635 31.6513 205.405 32.91C207.214 34.1293 208.571 35.8207 209.476 37.984C210.42 40.1473 210.892 42.645 210.892 45.477V47.719H188.472C188.472 51.9277 189.436 55.1333 191.363 57.336C193.33 59.5387 196.103 60.64 199.682 60.64C201.649 60.64 203.36 60.4827 204.815 60.168C206.27 59.8533 207.863 59.3027 209.594 58.516V61.584C208.021 62.292 206.467 62.8033 204.933 63.118C203.399 63.4327 201.609 63.59 199.564 63.59C196.457 63.59 193.802 62.941 191.599 61.643C189.436 60.345 187.784 58.4963 186.643 56.097C185.542 53.6583 184.991 50.8263 184.991 47.601C184.991 44.3757 185.522 41.524 186.584 39.046C187.646 36.568 189.2 34.621 191.245 33.205C193.29 31.7497 195.768 31.022 198.679 31.022ZM198.679 33.854C195.768 33.854 193.428 34.8177 191.658 36.745C189.888 38.633 188.846 41.3667 188.531 44.946H207.411C207.411 42.7433 207.096 40.816 206.467 39.164C205.838 37.512 204.874 36.214 203.576 35.27C202.317 34.326 200.685 33.854 198.679 33.854ZM228.224 60.758C229.089 60.758 229.915 60.699 230.702 60.581C231.488 60.4237 232.177 60.2467 232.767 60.05V62.764C232.177 63 231.429 63.1967 230.525 63.354C229.659 63.5113 228.735 63.59 227.752 63.59C226.021 63.59 224.546 63.2753 223.327 62.646C222.107 61.9773 221.163 60.9547 220.495 59.578C219.865 58.2013 219.551 56.4313 219.551 54.268V34.326H214.949V32.438L219.551 31.376L220.79 24.119H222.914V31.612H232.59V34.326H222.914V54.15C222.914 56.3133 223.346 57.9653 224.212 59.106C225.077 60.2073 226.414 60.758 228.224 60.758Z"
                                fill="#2BC7BC" />
                            <path
                                d="M50.065 43C50.065 51.7438 48.6716 59.6142 46.4541 65.2619C45.3441 68.0888 44.0472 70.3087 42.6582 71.8049C41.2704 73.2999 39.8645 74 38.5003 74C37.1361 74 35.7302 73.2999 34.3424 71.8049C32.9534 70.3087 31.6565 68.0888 30.5465 65.2619C28.3289 59.6142 26.9355 51.7438 26.9355 43C26.9355 34.2562 28.3289 26.3858 30.5465 20.7381C31.6565 17.9112 32.9534 15.6913 34.3424 14.1951C35.7302 12.7001 37.1361 12 38.5003 12C39.8645 12 41.2704 12.7001 42.6582 14.1951C44.0472 15.6913 45.3441 17.9112 46.4541 20.7381C48.6716 26.3858 50.065 34.2562 50.065 43Z"
                                stroke="#2BC7BC" stroke-width="2" />
                            <path
                                d="M46.59 36.8192C54.713 43.0255 61.0476 49.3763 64.7342 54.6073C66.581 57.2279 67.7315 59.523 68.1385 61.3512C68.5515 63.2063 68.1623 64.3776 67.3208 65.0206C66.4793 65.6635 64.9463 65.9609 62.5182 65.6454C60.1254 65.3344 57.1215 64.4554 53.6916 63.0443C46.8451 60.2276 38.533 55.3877 30.41 49.1814C22.287 42.975 15.9524 36.6243 12.2658 31.3932C10.419 28.7727 9.26846 26.4775 8.86149 24.6493C8.44851 22.7942 8.83776 21.6229 9.67923 20.98C10.5207 20.337 12.0537 20.0396 14.4818 20.3552C16.8746 20.6661 19.8785 21.5452 23.3084 22.9562C30.1549 25.773 38.467 30.6128 46.59 36.8192Z"
                                stroke="#2BC7BC" stroke-width="2" />
                            <path
                                d="M46.59 49.1808C54.713 42.9745 61.0476 36.6237 64.7342 31.3927C66.581 28.7721 67.7315 26.477 68.1385 24.6488C68.5515 22.7937 68.1623 21.6224 67.3208 20.9794C66.4793 20.3365 64.9463 20.0391 62.5182 20.3546C60.1254 20.6656 57.1215 21.5446 53.6916 22.9557C46.8451 25.7724 38.533 30.6123 30.41 36.8186C22.287 43.025 15.9524 49.3757 12.2658 54.6068C10.419 57.2273 9.26846 59.5225 8.86149 61.3507C8.44851 63.2058 8.83776 64.3771 9.67923 65.02C10.5207 65.663 12.0537 65.9604 14.4818 65.6448C16.8746 65.3339 19.8785 64.4548 23.3084 63.0438C30.1549 60.227 38.467 55.3872 46.59 49.1808Z"
                                stroke="#2BC7BC" stroke-width="2" />
                            <ellipse cx="38.4999" cy="43" rx="4.27778" ry="4.17391" fill="#2BC7BC" />
                        </svg>
                    </div>
                </div>
                <p class="text-gray font-bold text-xl tracking-wider font-poppins mb-8 pt-4">従業員アンケート</p>
            </div>
            <div class="w-72 mx-auto space-y-4">
                @foreach ($hierarchies as $hierarchy)
                    @php
                        $orgNames = $hierarchy->organizationNames->where('company_id', $survey->company_id);
                    @endphp

                    @if ($orgNames->isNotEmpty())
                        <div class="mb-4">
                            <label for="organization_{{ $hierarchy->id }}" class="block text-xs text-gray mb-2 text-left">{{ $hierarchy->name }} 選択</label>
                            <select id="organization_{{ $hierarchy->id }}" class="text-sm border border-placeholder p-2 pl-[0.63rem] w-full rounded-lg organization-select text-gray" data-hierarchy-id="{{ $hierarchy->id }}">
                                <option value="">選択してください</option>
                                @foreach ($orgNames as $org)
                                    <option value="{{ $org->id }}" data-parent-id="{{ $org->parent_id ?? '' }}">{{ $org->name }}</option>
                                @endforeach
                            </select>
                        </div>
                    @endif
                @endforeach
                <input type="hidden" name="organization_hierarchies_id" id="selectedDepartmentId">
            </div>
            <div class="mt-12 mb-16 flex justify-center">
                <button id="nextButton"
                    class="bg-[#F5C242] hover:bg-[#FED670] text-white font-bold text-2xl py-[1.75rem] px-[4.5rem] tracking-wider rounded-xl shadow-lg transition-all duration-300 disabled:bg-[#F5C242]">
                    回答画面へ
                </button>
            </div>
        </div>

        <div id="survey-screen" class="card hidden bg-white rounded-lg shadow-lg text-center w-full">
            <div class="bg-[#40c7bd] text-white pt-11 pb-3 flex flex-col items-center text-center fixed top-0 left-0 w-full z-10" id="survey-header">
                <svg width="150" height="50" viewBox="0 0 100 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M48.1 10.2C47 10.2 46.0083 10.3917 45.125 10.775C44.2583 11.1417 43.525 11.675 42.925 12.375C42.325 13.0583 41.8667 13.8833 41.55 14.85C41.2333 15.8 41.075 16.8583 41.075 18.025C41.075 19.625 41.325 21.025 41.825 22.225C42.325 23.4083 43.075 24.325 44.075 24.975C45.0917 25.625 46.35 25.95 47.85 25.95C48.7167 25.95 49.5167 25.8833 50.25 25.75C50.9833 25.6167 51.6583 25.45 52.275 25.25V26.5C51.675 26.7333 51 26.9167 50.25 27.05C49.5167 27.1833 48.6583 27.25 47.675 27.25C45.8917 27.25 44.3917 26.8667 43.175 26.1C41.975 25.3333 41.0667 24.2583 40.45 22.875C39.85 21.4917 39.55 19.875 39.55 18.025C39.55 16.7083 39.7417 15.4917 40.125 14.375C40.5083 13.2583 41.0667 12.2917 41.8 11.475C42.5333 10.6583 43.425 10.025 44.475 9.575C45.5417 9.125 46.7583 8.9 48.125 8.9C48.975 8.9 49.7917 8.98333 50.575 9.15C51.375 9.31667 52.1167 9.55833 52.8 9.875L52.225 11.15C51.5917 10.8333 50.925 10.6 50.225 10.45C49.5417 10.2833 48.8333 10.2 48.1 10.2ZM66.9012 20.35C66.9012 21.3833 66.7678 22.325 66.5012 23.175C66.2512 24.0083 65.8678 24.7333 65.3512 25.35C64.8512 25.95 64.2262 26.4167 63.4762 26.75C62.7262 27.0833 61.8678 27.25 60.9012 27.25C59.9845 27.25 59.1595 27.0917 58.4262 26.775C57.7095 26.4417 57.0928 25.975 56.5762 25.375C56.0595 24.7583 55.6678 24.025 55.4012 23.175C55.1345 22.325 55.0012 21.3833 55.0012 20.35C55.0012 18.9 55.2345 17.6667 55.7012 16.65C56.1845 15.6167 56.8762 14.825 57.7762 14.275C58.6928 13.725 59.7762 13.45 61.0262 13.45C62.2928 13.45 63.3595 13.7417 64.2262 14.325C65.1095 14.8917 65.7762 15.6917 66.2262 16.725C66.6762 17.7583 66.9012 18.9667 66.9012 20.35ZM56.4762 20.35C56.4762 21.4833 56.6345 22.4833 56.9512 23.35C57.2678 24.2 57.7595 24.8583 58.4262 25.325C59.0928 25.7917 59.9262 26.025 60.9262 26.025C61.9595 26.025 62.8095 25.7917 63.4762 25.325C64.1428 24.8417 64.6345 24.175 64.9512 23.325C65.2678 22.4583 65.4262 21.4667 65.4262 20.35C65.4262 19.2333 65.2762 18.25 64.9762 17.4C64.6762 16.55 64.2012 15.8833 63.5512 15.4C62.9012 14.9167 62.0512 14.675 61.0012 14.675C59.4845 14.675 58.3512 15.175 57.6012 16.175C56.8512 17.175 56.4762 18.5667 56.4762 20.35ZM75.9723 13.475C76.3056 13.475 76.6223 13.5 76.9223 13.55C77.2389 13.5833 77.5223 13.6333 77.7723 13.7L77.5723 15C77.3056 14.9333 77.0389 14.8833 76.7723 14.85C76.5056 14.8 76.2139 14.775 75.8973 14.775C75.2973 14.775 74.7556 14.8917 74.2723 15.125C73.7889 15.3583 73.3723 15.6917 73.0223 16.125C72.6723 16.5583 72.4056 17.075 72.2223 17.675C72.0389 18.275 71.9473 18.95 71.9473 19.7V27H70.5223V13.7H71.7223L71.8723 16.2H71.9473C72.1639 15.6833 72.4556 15.225 72.8223 14.825C73.2056 14.4083 73.6639 14.0833 74.1973 13.85C74.7306 13.6 75.3223 13.475 75.9723 13.475ZM84.8979 13.45C86.0479 13.45 86.9979 13.7167 87.7479 14.25C88.5145 14.7667 89.0895 15.4833 89.4729 16.4C89.8729 17.3167 90.0729 18.375 90.0729 19.575V20.525H80.5729C80.5729 22.3083 80.9812 23.6667 81.7979 24.6C82.6312 25.5333 83.8062 26 85.3229 26C86.1562 26 86.8812 25.9333 87.4979 25.8C88.1145 25.6667 88.7895 25.4333 89.5229 25.1V26.4C88.8562 26.7 88.1979 26.9167 87.5479 27.05C86.8979 27.1833 86.1395 27.25 85.2729 27.25C83.9562 27.25 82.8312 26.975 81.8979 26.425C80.9812 25.875 80.2812 25.0917 79.7979 24.075C79.3312 23.0417 79.0979 21.8417 79.0979 20.475C79.0979 19.1083 79.3229 17.9 79.7729 16.85C80.2229 15.8 80.8812 14.975 81.7479 14.375C82.6145 13.7583 83.6645 13.45 84.8979 13.45ZM84.8979 14.65C83.6645 14.65 82.6729 15.0583 81.9229 15.875C81.1729 16.675 80.7312 17.8333 80.5979 19.35H88.5979C88.5979 18.4167 88.4645 17.6 88.1979 16.9C87.9312 16.2 87.5229 15.65 86.9729 15.25C86.4395 14.85 85.7479 14.65 84.8979 14.65ZM97.4168 26.05C97.7835 26.05 98.1335 26.025 98.4668 25.975C98.8001 25.9083 99.0918 25.8333 99.3418 25.75V26.9C99.0918 27 98.7751 27.0833 98.3918 27.15C98.0251 27.2167 97.6335 27.25 97.2168 27.25C96.4835 27.25 95.8585 27.1167 95.3418 26.85C94.8251 26.5667 94.4251 26.1333 94.1418 25.55C93.8751 24.9667 93.7418 24.2167 93.7418 23.3V14.85H91.7918V14.05L93.7418 13.6L94.2668 10.525H95.1668V13.7H99.2668V14.85H95.1668V23.25C95.1668 24.1667 95.3501 24.8667 95.7168 25.35C96.0835 25.8167 96.6501 26.05 97.4168 26.05Z"
                        fill="white" />
                    <path
                        d="M22.1981 14.5C22.1981 18.4725 21.5814 22.0532 20.5962 24.628C20.1031 25.9166 19.5246 26.9353 18.9 27.6257C18.2754 28.3162 17.6328 28.65 17 28.65C16.3672 28.65 15.7246 28.3162 15.1 27.6257C14.4754 26.9353 13.8969 25.9166 13.4038 24.628C12.4186 22.0532 11.8019 18.4725 11.8019 14.5C11.8019 10.5275 12.4186 6.9468 13.4038 4.37203C13.8969 3.08345 14.4754 2.06473 15.1 1.37428C15.7246 0.683835 16.3672 0.35 17 0.35C17.6328 0.35 18.2754 0.683835 18.9 1.37428C19.5246 2.06473 20.1031 3.08345 20.5962 4.37203C21.5814 6.9468 22.1981 10.5275 22.1981 14.5Z"
                        stroke="white" stroke-width="0.7" />
                    <path
                        d="M20.6476 11.6401C24.2397 14.4564 27.0438 17.3405 28.6779 19.7198C29.4961 20.9112 30.0099 21.9603 30.1923 22.8012C30.3768 23.6518 30.2096 24.2171 29.8015 24.5371C29.3934 24.8571 28.6724 24.9882 27.5876 24.8435C26.515 24.7005 25.177 24.2976 23.6574 23.6561C20.6228 22.3749 16.9444 20.1763 13.3524 17.36C9.76035 14.5436 6.95616 11.6595 5.32215 9.28022C4.50391 8.08878 3.99012 7.03974 3.80769 6.19877C3.62319 5.34822 3.79038 4.78291 4.19851 4.46292C4.60664 4.14292 5.32764 4.01183 6.41245 4.1565C7.48503 4.29953 8.823 4.70237 10.3426 5.34391C13.3772 6.62507 17.0556 8.82371 20.6476 11.6401Z"
                        stroke="white" stroke-width="0.7" />
                    <path
                        d="M20.6476 17.36C24.2397 14.5436 27.0438 11.6595 28.6779 9.28023C29.4961 8.08879 30.0099 7.03975 30.1923 6.19878C30.3768 5.34823 30.2096 4.78293 29.8015 4.46293C29.3934 4.14293 28.6724 4.01184 27.5876 4.15651C26.515 4.29954 25.177 4.70238 23.6574 5.34392C20.6228 6.62508 16.9444 8.82372 13.3524 11.6401C9.76035 14.4564 6.95616 17.3405 5.32215 19.7198C4.50391 20.9112 3.99012 21.9603 3.80769 22.8013C3.62319 23.6518 3.79038 24.2171 4.19851 24.5371C4.60664 24.8571 5.32764 24.9882 6.41245 24.8435C7.48503 24.7005 8.823 24.2977 10.3426 23.6561C13.3772 22.375 17.0556 20.1763 20.6476 17.36Z"
                        stroke="white" stroke-width="0.7" />
                    <ellipse cx="17" cy="14.5" rx="1.88889" ry="1.8913" fill="white" />
                </svg>
                <p class="text-base tracking-wide">従業員アンケート</p>

                <div class="w-full max-w-2xl mx-auto mt-12 px-4">
                    <div class="w-full bg-white rounded-full h-4 overflow-hidden shadow flex items-center">
                        <div id="progress-bar" class="mx-2 bg-yellow-400 h-[40%] rounded-full items-center justify-center transition-all duration-500 ease-in-out" style="width: 0%"></div>
                    </div>
                    <p class="text-base mt-2 mb-4">このアンケートは全部で16問あります。</p>
                </div>
            </div>
            <div class="flex-1 bg-[#F0F0F3]">
                <div class="max-w-5xl mx-auto px-4 pt-80">
                    <div class="space-y-24">
                        <form id="survey-form">
                            @csrf
                            <input type="hidden" id="survey_id" name="survey_id" value="{{ $survey->id }}">
                            <input type="hidden" id="selectedDepartment" name="department">

                            @foreach ($questions as $question)
                                <div class="text-center question-container pb-24" id="{{ $question->id }}">
                                    <p class="mb-6 text-[#5F6368] text-xl">{{ $question->question_text }}</p>
                                    @php
                                        $labels = [
                                            1 => '全く思わない',
                                            2 => 'あまり思わない',
                                            3 => 'どちらでもない',
                                            4 => '少し思う',
                                            5 => 'とてもそう思う',
                                        ];
                                    @endphp
                                    <div class="flex justify-center gap-4 flex-wrap">
                                        @foreach ($labels as $key => $label)
                                            <label class="cursor-pointer">
                                                <input type="radio" name="answers[{{ $question->id }}]" value="{{ $key }}" class="hidden peer">
                                                <span class="flex items-center justify-center text-[#60666C] option-btn w-[170px] h-14 rounded-full text-base bg-white font-bold hover:text-[#AFB2B5]">{{ $label }}</span>
                                            </label>
                                        @endforeach
                                    </div>
                                </div>
                            @endforeach
                            <div class="pb-72">
                                <button type="button" id="submit-button" class="text-xl bg-[#40c7bd] hover:bg-[#38B5AC] text-white font-bold py-4 px-16 rounded-lg transition-all duration-300 flex items-center justify-center mx-auto disabled:opacity-50 disabled:cursor-not-allowe">送信</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const startButton = document.getElementById('startButton');
    const nextButton = document.getElementById('nextButton');
    const homeScreen = document.getElementById('home-screen');
    const departmentScreen = document.getElementById('department-screen');
    const surveyScreen = document.getElementById('survey-screen');
    const submitButton = document.getElementById('submit-button');
    const progressBar = document.getElementById('progress-bar');
    const errorMessage = document.createElement('div'); // エラーメッセージ用のdiv
    errorMessage.className = 'text-red-500 text-center mt-4'; // エラーメッセージのスタイル
    errorMessage.textContent = '親組織を選択してください。'; // エラーメッセージ内容

    let answeredQuestions = 0;
    const totalQuestions = document.querySelectorAll('.question-container').length;

    // ホーム画面から部署選択画面に遷移
    startButton.addEventListener('click', function() {
        homeScreen.classList.add('hidden');
        departmentScreen.classList.remove('hidden');
    });

    // 部署選択画面からアンケート画面に遷移
    nextButton.addEventListener('click', function() {
        const departmentSelects = document.querySelectorAll('.organization-select');
        let isSelected = false;
        let parentMissing = false;

        // 組織が1つ以上選択されているかチェック
        departmentSelects.forEach(select => {
            if (select.value !== "") {
                isSelected = true; // 少なくとも1つの組織が選択されている

                // 親組織のチェック
                const selectedOrg = select.options[select.selectedIndex];
                const parentId = selectedOrg.dataset.parentId;

                // 親組織が選択されていない場合、親組織を選択するようエラーメッセージを表示
                if (parentId && !Array.from(departmentSelects).some(s => s.value === parentId)) {
                    parentMissing = true;
                }
            }
        });

        if (!isSelected) {
            // 組織が選択されていなければエラーメッセージを表示
            if (!document.contains(errorMessage)) {
                departmentScreen.appendChild(errorMessage); // エラーメッセージを部署選択画面に追加
            }
            return; // 画面遷移を阻止
        }

        if (parentMissing) {
            // 親組織が選択されていない場合、エラーメッセージを表示
            if (!document.contains(errorMessage)) {
                errorMessage.textContent = '親組織を選択してください。';
                departmentScreen.appendChild(errorMessage);
            }
            return;
        }

        // エラーメッセージが表示されていれば削除
        if (document.contains(errorMessage)) {
            departmentScreen.removeChild(errorMessage);
        }

        departmentScreen.classList.add('hidden');
        surveyScreen.classList.remove('hidden');
    });

    // 最上位階層（最初の階層）の組織が選択されたかをチェック
    const departmentSelects = document.querySelectorAll('.organization-select');
    departmentSelects.forEach(select => {
        select.addEventListener('change', function() {
            const selectedDepartment = document.getElementById('selectedDepartmentId');
            selectedDepartment.value = select.value; // 部署のIDを隠しフィールドに設定

            // 最上位階層が選択されたら、次へ進むボタンを有効化
            const topLevelSelected = Array.from(departmentSelects).some(select => select.value !== "");
            if (topLevelSelected) {
                nextButton.disabled = false;
            } else {
                nextButton.disabled = true;
            }

            // エラーメッセージが表示されていれば削除
            if (document.contains(errorMessage)) {
                departmentScreen.removeChild(errorMessage);
            }
        });
    });
    
    const radioButtons = document.querySelectorAll('input[type="radio"]');
    radioButtons.forEach(button => {
        button.addEventListener('change', function() {
            // すべての選択肢をリセット
            const optionBtns = button.closest('.question-container').querySelectorAll('.option-btn');
            optionBtns.forEach(option => option.classList.remove('bg-yellow-300'));
            
            // クリックされた選択肢の背景色を変更
            button.closest('label').querySelector('.option-btn').classList.add('bg-yellow-300');

            // 進捗バーの更新
            answeredQuestions++;
            const progress = (answeredQuestions / totalQuestions) * 100;
            progressBar.style.width = `${progress}%`;
        });
    });

    // 送信ボタンのクリック処理
    submitButton.addEventListener('click', function() {
    console.log("送信ボタンがクリックされました");
    const departmentId = document.getElementById('selectedDepartmentId').value;
    const formData = new FormData(document.getElementById('survey-form'));
    formData.append('department_id', departmentId);

    // FormDataの内容をコンソールに出力して確認
    for (let [key, value] of formData.entries()) {
        console.log(`${key}: ${value}`);
    }

    // 送信処理
    fetch('{{ route("survey.store", $survey->id) }}', {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        if (data.redirect) {
            window.location.href = data.redirect; // Thanksページに遷移
        } else if (data.error) {
            // エラーメッセージ表示
            alert(data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
});

});
    </script>
@endsection
